---
# ============================================================================
# Global Variables for Cyber Range Automation
# ============================================================================
# These variables are available to all hosts and playbooks
#
# Usage:
#   Variables automatically loaded when using:
#   ansible-playbook -i inventory/hosts.yml playbook.yml --ask-vault-pass
#
# Override from command line:
#   -e max_student_groups=15
#   -e class_code=2
# ============================================================================

# ==========================================
# Campaign Configuration
# ==========================================
class_code: 1
class_name: "cyber-war-gaming"
course_prefix: "CNT4416"
max_student_groups: 2

# Campaign execution settings (Stage 2+)
campaign_duration_hours: 24
campaign_id: "{{ course_prefix }}_{{ ansible_date_time.epoch }}"

# ==========================================
# Proxmox Host Configuration
# ==========================================
proxmox_host: "192.168.68.89"
proxmox_user: "root"
proxmox_node: "hm-hcr-08"

# Proxmox API (for later stages)
proxmox_api_host: "192.168.68.89"
proxmox_api_user: "root@pam"
proxmox_api_token_id: "ansible-token"
proxmox_api_token: "{{ vault_proxmox_api_token }}"
proxmox_verify_ssl: false

# ==========================================
# Proxmox Storage
# ==========================================
storage: "raid-lvm"
ovf_storage: "ovfstore"
iso_storage: "ISO_Library"

# ==========================================
# Network Configuration (Stage 0)
# ==========================================

# Physical interface on Proxmox
physical_interface: "ens3f0np0"

# Management network configuration
management_ip: "192.168.68.89"
management_netmask: "24"
management_gateway: "192.168.68.1"

# Proxmox network interfaces file
interfaces_file: "/etc/network/interfaces"
interfaces_backup: "/etc/network/interfaces.bak.{{ ansible_date_time.epoch }}"

# ==========================================
# Bridge Configuration
# ==========================================
# Bridge naming convention: vmbrXXXYYY
#   XXX = Group ID (255 = instructor, 001-015 = students)
#   YYY = Network type (000 = LAN, specific number for WAN)
#
# Infrastructure bridges are created in Stage 0
# Student bridges are dynamically generated based on max_student_groups

bridges:
  # Infrastructure bridges (always present)
  management: "vmbr0"
  management_vlan: 68 # Added VLAN tag
  spark_wan: "vmbr50"
  spark_lan: "vmbr0"
  instructor_wan: "vmbr51"
  instructor_lan: "vmbr255000"
  instructor_vlan: 255 # VLAN tag for instructor LAN
  vlan_wan: "vmbr255"
  vlan_lan: "vmbr100"
  # Student bridge naming patterns (for dynamic generation)
  # WAN interconnect: vmbr255{group:03d}  (e.g., vmbr255001, vmbr255002)
  # LAN segment:      vmbr{group:03d}000  (e.g., vmbr001000, vmbr002000)

  # ==========================================
  # VM Templates (OVF Files)
  # ==========================================
templates:
  pfsense_spark: "/mnt/pve/ovfstore/TEMPLATE-pfsense-student-20250621-Experiment.ovf"
  pfsense_instructor: "/mnt/pve/ovfstore/TEMPLATE-pfsense-student-20250621-Experiment.ovf"
  pfsense_student: "/mnt/pve/ovfstore/TEMPLATE-pfsense-student-20250621-Experiment.ovf"
  pfsense_template_id: 8000 #replace once we have dedicated templates
  instructor_pfsense_template_id: 8000
  group1_pfsense_template_id: 8001
  group2_pfsense_template_id: 8002
  spark_pfsense_template_id: 8003
  vlan_instructor_pfsense_template_id: 8004
  vlan_student_pfsense_template_id: 8005
  kali: "/mnt/pve/ovfstore/TEMPLATE-kali-20241124-Experiment.ovf"
  ms3_ubuntu: "/mnt/pve/ovfstore/TEMPLATE-ms3ub1404-20250621-Experiment.ovf"
  ms3_windows: "/mnt/pve/ovfstore/imports/virtualbox/box.ovf"
  security_onion: "/mnt/pve/ovfstore/TEMPLATE-so-master-20250621-Experiment.ovf" #need to update this with the correct one
  car: "/mnt/pve/ovfstore/TEMPLATE-car-20250428.ovf"

# ISO files (for Stage 2+)
isos:
  windows_server_2008: "ISO_Library:iso/WS2008R2SP1-KB4474419.iso,media=cdrom,size=54894K"

# ==========================================
# VM ID Allocation Scheme
# ==========================================
# VMs are allocated in blocks of 10 per group for organization
#
# Infrastructure (IDs 50-199):
#   50:  Spark pfSense (Internet gateway)
#   151: Instructor pfSense
#   152: Instructor Kali
#   159: Security Onion
#
# Student Groups (IDs 200+):
#   Group 1: 201-210
#     201: pfSense
#     202: Kali 1
#     203: Kali 2
#     204: Ubuntu
#     205: Windows
#
#   Group 2: 301-320
#     301: pfSense
#     302: Kali 1
#     303: Kali 2
#     304: Ubuntu
#     305: Windows
#
#   Group N: (200 + (N-1)*100 + 1) through (200 + N*100)
#
# VM ID Formulas:
#   Student pfSense:  200 + ((group_id - 1) * 100) + 1
#   Student Kali 1:   200 + ((group_id - 1) * 100) + 2
#   Student Kali 2:   200 + ((group_id - 1) * 100) + 3
#   Student Ubuntu:   200 + ((group_id - 1) * 100) + 4
#   Student Windows:  200 + ((group_id - 1) * 100) + 5

vm_ids:
  # Infrastructure VMs (fixed IDs)
  car: 110
  spark_pfsense: 111
  instructor_pfsense: 151
  instructor_kali: 152
  security_onion: 159

  # Student VM base ID (formulas calculated in Stage 2+)
  student_base: 200
  student_block_size: 100

# ==========================================
# Security Onion Configuration (Stage 1)
# ==========================================
# Security Onion is created from ISO in Stage 1
# Installation must be completed manually through Proxmox console
# After installation, IP address will be: 143.88.255.9/24
# Will need to change exact location and boot configs later

security_onion:
  vmid: 159
  name: "so-master"

  # ISO-based installation (not OVF)
  iso: "ISO_Library:iso/securityonion-2.4.180-20250916.iso"

  # Hardware configuration (matching Proxmox screenshots)
  memory: 32000 # 31.25 GiB (32000 MB)
  cores: 8
  sockets: 1
  machine: "q35" # Modern chipset

  # Storage configuration
  storage: "raid-lvm"
  disk_size: "2000" # 2TB primary disk (size in GB)

  # Network configuration
  management_bridge: "vmbr255000" # Instructor LAN
  # Note: management_ip will be set during Security Onion installation,
  # not by Ansible. Expected value: 143.88.255.9/24

  # BIOS/Boot configuration
  bios: "ovmf" # UEFI (OVMF) - matches screenshot
  scsihw: "virtio-scsi-single" # VirtIO SCSI single - matches screenshot
  boot_order: "scsi0;ide2" # Boot from disk first, then ISO

# ==========================================
# VM Resource Defaults
# ==========================================

# pfSense VM resource defaults
pfsense_resources:
  memory: 2048 # 2 GiB
  cores: 2
  sockets: 1

# Kali VM resource defaults (if needed later)
kali_resources:
  memory: 8192 # 8 GiB
  cores: 6
  sockets: 1

# MS3 VM resource defaults (if needed later)
ms3_resources:
  memory: 4096 # 4 GiB
  cores: 2
  sockets: 1

# ==========================================
# Automation Configuration (Stage 2+)
# ==========================================
automation:
  # Auto-runner settings
  auto_run_delay: 60 # seconds to wait after boot

  # Cron schedule for automatic campaigns
  cron_schedule: "@reboot"

  # Campaign defaults
  default_duration_hours: 24

  # Retry settings
  ssh_retry_count: 60
  ssh_retry_delay: 10

  # Boot wait times
  vm_boot_wait_seconds: 30
  pfsense_boot_wait_seconds: 30

# ==========================================
# SSH Configuration
# ==========================================
ssh:
  # SSH keys (for Security Onion access)
  analyst_key_path: "/home/analyst/.ssh/id_rsa"
  analyst_pubkey_path: "/home/analyst/.ssh/id_rsa.pub"

  # Common SSH options
  common_args: "-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null"
